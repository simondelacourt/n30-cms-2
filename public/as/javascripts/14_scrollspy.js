(function($){var jWindow=$(window);var elements=[];var elementsInView=[];var isSpying=false;var ticks=0;function findElements(top,right,bottom,left){var hits=$();$.each(elements,function(i,element){var elTop=element.offset().top,elLeft=element.offset().left,elRight=elLeft+element.width(),elBottom=elTop+element.height();var isIntersect=!(elLeft>right||elRight<left||elTop>bottom||elBottom<top);if(isIntersect){hits.push(element)}});return hits}function onScroll(){++ticks;var top=jWindow.scrollTop(),left=jWindow.scrollLeft(),right=left+jWindow.width(),bottom=top+jWindow.height();var intersections=findElements(top,right,bottom,left);$.each(intersections,function(i,element){var lastTick=element.data("scrollSpy:ticks");if(typeof lastTick!="number"){element.triggerHandler("scrollSpy:enter")}element.data("scrollSpy:ticks",ticks)});$.each(elementsInView,function(i,element){var lastTick=element.data("scrollSpy:ticks");if(typeof lastTick=="number"&&lastTick!==ticks){element.triggerHandler("scrollSpy:exit");element.data("scrollSpy:ticks",null)}});elementsInView=intersections}$.scrollSpy=function(selector){selector=$(selector);selector.each(function(i,element){elements.push($(element))});if(!isSpying){jWindow.on("scroll",onScroll);isSpying=true;setTimeout(function(){$(document).ready(onScroll)},0)}return selector};$.fn.scrollSpy=function(){return $.scrollSpy($(this))}})(jQuery);